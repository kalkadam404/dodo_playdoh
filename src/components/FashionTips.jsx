import { useEffect, useRef, useState } from "react";
import { Link } from "react-router-dom";
import { ReadCardsBlock } from "./ReadCardsBlock";
import DodoAndPlayDoh from "/playdoh.png";
import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/all";
import { getCurrentPromoCode } from "../utils/getPromoCode";

gsap.registerPlugin(ScrollTrigger);

function FashionTips() {
  const svg1Ref = useRef(null);
  const svg2Ref = useRef(null);
  const svg3Ref = useRef(null);

  const logoRef = useRef(null);
  const headingRef = useRef(null);
  const paragraphRef = useRef(null);
  const policyRef = useRef(null);
  const buttonsRef = useRef(null);
  const [promo, setPromo] = useState(getCurrentPromoCode());
  const [copied, setCopied] = useState(false);
  const copyTimeoutRef = useRef(null);

  useEffect(() => {
    const handlePromoUpdate = () => {
      const newPromo = getCurrentPromoCode();
      setPromo(newPromo);
    };

    window.addEventListener("promoCodeUpdated", handlePromoUpdate);

    return () => {
      window.removeEventListener("promoCodeUpdated", handlePromoUpdate);
    };
  }, []);

  useGSAP(() => {
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: headingRef.current, // триггер — блок текста
        start: "top 80%",
      },
    });
    tl.from(svg1Ref.current, {
      y: -200,
      opacity: 0,
      duration: 0.7,
      ease: "elastic.inOut",
    })
      .from(headingRef.current, {
        opacity: 0,
        y: 20,
        duration: 0.6,
        ease: "power2.out",
      })
      // Параграф
      .from(
        paragraphRef.current,
        {
          opacity: 0,
          y: 20,
          duration: 0.8,
          ease: "power2.out",
        },
        "-=0.4"
      )
      // Кнопки
      .from(
        buttonsRef.current,
        {
          opacity: 0,
          y: 20,
          duration: 0.8,
          ease: "power2.out",
        },
        "-=0.4"
      )
      .from(
        policyRef.current,
        {
          opacity: 0,
          y: 20,
          duration: 0.8,
          ease: "power2.out",
        },
        "-=0.4"
      )
      // Логотип сверху
      .from(
        logoRef.current,
        {
          opacity: 0,
          y: -80,
          duration: 1,
          ease: "elastic.out(1, 0.5)",
        },
        "-=0.4"
      );
  }, []);

  useEffect(() => {
    return () => {
      if (copyTimeoutRef.current) clearTimeout(copyTimeoutRef.current);
    };
  }, []);

  const handleCopyPromo = () => {
    if (!promo) return;
    const copyAction = navigator?.clipboard?.writeText
      ? navigator.clipboard.writeText(promo)
      : Promise.resolve();

    copyAction
      .then(() => {
        setCopied(true);
        if (copyTimeoutRef.current) clearTimeout(copyTimeoutRef.current);
        copyTimeoutRef.current = setTimeout(() => setCopied(false), 2000);
      })
      .catch(() => {});
  };

  return (
    <>
      <div className="bg-orange-500 rounded-t-4xl xl:rounded-t-[60px] max-sm:-mt-5 w-full ">
        <div className="flex items-center justify-center p-40 max-sm:p-4 max-sm:flex-col-reverse max-sm:gap-30 max-sm:pb-30 max-sm:pt-10">
          <div className="relative text-white w-full ">
            <img
              ref={logoRef}
              src="/dodo_logo.png"
              alt=""
              className="absolute -top-9 right-4 max-sm:w-28 max-sm:-top-10 max-sm:right-2 "
            />
            <h2
              ref={headingRef}
              className="w-3xl font-helvetica-black xl:max-w-2xl text-6xl max-sm:text-[32px] 
              uppercase leading-none tracking-tighter  mb-6 max-sm:mb-6 max-sm:w-full"
            >
              Получите <br /> промокод -10% <br /> на заказ детского <br />{" "}
              комбо Play Dodo
            </h2>
            <p
              ref={paragraphRef}
              className="text-xl max-sm:text-base font-rooftop-bold
             mb-10 max-sm:mb-9 leading-none"
            >
              Пробуйте детское комбо Play Dodo и узнавайте <br /> интересные
              факты о редких животных Казахстана!
            </p>
            <div
              ref={buttonsRef}
              className="flex font-bold justify-start gap-5 items-center w-full max-sm:justify-between mb-8"
            >
              <div className="flex flex-col gap-2 max-sm:flex-1 relative">
                <button
                  onClick={handleCopyPromo}
                  className="bg-white text-black rounded-[20px] h-24 max-sm:h-auto px-8 max-sm:py-3 max-sm:px-6 max-sm:flex-1"
                >
                  <p className="text-2xl font-rooftop-bold max-sm:text-sm">
                    Ваш промокод
                  </p>
                  <p className="text-4xl font-rooftop-bold max-sm:text-xl">
                    {promo || "X-XX-XXX"}
                  </p>
                </button>
                {copied && (
                  <p
                    className={`absolute -bottom-8 left-2 text-white text-lg font-rooftop-bold max-sm:text-xs max-sm:-bottom-6 transition-opacity duration-300 ${
                      copied ? "opacity-100" : "opacity-0"
                    }`}
                  >
                    Промокод скопирован
                  </p>
                )}
              </div>
              <a
                href="https://dodopizza.kz/almaty/product/play-dodo-kombo?utm_source=elle_fix&utm_medium=specStorie_web_app&utm_campaign=marketing_kz_PlayDoh_1125&utm_term="
                target="_blank"
                rel="noopener noreferrer"
              >
                <button className=" text-4xl font-rooftop-bold h-24 px-8 rounded-[20px] border-4 border-white leading-none max-sm:h-auto max-sm:text-xl max-sm:py-3 max-sm:flex-1 text-center cursor-pointer">
                  Заказать <br /> в Dodo
                </button>
              </a>
            </div>
            <div ref={policyRef} className="text-white font-rooftop text-sm">
              Скидка действует при заказе через мобильное приложение,
              применяется ко всему заказу, кроме добавленных ингредиентов.
              Действует до 31 декабря 2025 года, пока продукция есть в наличии.{" "}
              <Link
                to="/promo-rules"
                className="font-rooftop-bold underline underline-offset-auto [text-underline-position:from-font] hover:opacity-80 transition-opacity cursor-pointer"
              >
                Подробная информация о правилах акции
              </Link>
            </div>
          </div>
          <div className="relative w-full max-w-lg ">
            <div
              ref={svg1Ref}
              className="flex gap-5 items-center pointer-events-none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="154"
                height="44"
                viewBox="0 0 154 44"
                fill="none"
              >
                <path
                  d="M5.38804 0.286434L21.2391 1.91746C26.5962 2.46869 30.8585 4.23289 34.0261 7.21007C37.2342 10.1551 38.5876 13.9625 38.0862 18.6324L37.2243 26.6609C36.6998 31.5462 34.6147 35.0725 30.9691 37.2396C27.3234 39.4068 22.7487 40.2072 17.2448 39.6409L1.3387 38.0042C0.935082 37.9627 0.601931 37.7831 0.339245 37.4656C0.0765581 37.148 -0.0335744 36.7916 0.00884736 36.3965L3.74582 1.58835C3.78824 1.19322 3.97164 0.867063 4.29603 0.609893C4.62042 0.352723 4.98443 0.244903 5.38804 0.286434ZM16.5336 12.0564L14.7403 28.76L18.3178 29.1281C19.5654 29.2565 20.5946 28.9992 21.4056 28.3563C22.2571 27.6812 22.76 26.6253 22.9143 25.1884L23.7762 17.1599C24.0847 14.2862 22.863 12.7077 20.1111 12.4246L16.5336 12.0564Z"
                  fill="white"
                />
                <path
                  d="M43.9808 9.00014C47.375 6.32729 51.8577 4.99087 57.4288 4.99087C62.9998 4.99087 67.4641 6.34535 70.8215 9.05432C74.2158 11.7272 75.9129 15.5017 75.9129 20.3778V28.8298C75.9129 33.7782 74.2342 37.5527 70.8768 40.1533C67.5563 42.7178 63.0736 44 57.4288 44C51.7839 44 47.2828 42.7178 43.9254 40.1533C40.6049 37.5527 38.9447 33.7782 38.9447 28.8298V20.3778C38.9447 15.4655 40.6234 11.673 43.9808 9.00014ZM54.4403 32.3514C55.1782 33.0738 56.1744 33.435 57.4288 33.435C58.6832 33.435 59.6793 33.0738 60.4172 32.3514C61.1551 31.629 61.5241 30.5274 61.5241 29.0465V19.9444C61.5241 18.4996 61.1551 17.416 60.4172 16.6936C59.6793 15.9351 58.6832 15.5558 57.4288 15.5558C56.1744 15.5558 55.1782 15.9351 54.4403 16.6936C53.7024 17.416 53.3335 18.4996 53.3335 19.9444V29.0465C53.3335 30.5274 53.7024 31.629 54.4403 32.3514Z"
                  fill="white"
                />
                <path
                  d="M82.7302 0.00866154L98.5813 1.63969C103.938 2.19091 108.201 3.95512 111.368 6.9323C114.576 9.87734 115.93 13.6848 115.428 18.3546L114.566 26.3831C114.042 31.2684 111.957 34.7947 108.311 36.9619C104.666 39.129 100.091 39.9295 94.587 39.3631L78.6809 37.7264C78.2773 37.6849 77.9441 37.5054 77.6814 37.1878C77.4187 36.8702 77.3086 36.5138 77.351 36.1187L81.088 1.31058C81.1304 0.915444 81.3138 0.58929 81.6382 0.33212C81.9626 0.0749504 82.3266 -0.0328692 82.7302 0.00866154ZM93.8758 11.7787L92.0825 28.4823L95.66 28.8504C96.9075 28.9787 97.9368 28.7215 98.7478 28.0785C99.5993 27.4035 100.102 26.3475 100.256 24.9106L101.118 16.8821C101.427 14.0084 100.205 12.43 97.4533 12.1468L93.8758 11.7787Z"
                  fill="white"
                />
                <path
                  d="M122.068 7.12644C125.462 4.45359 129.945 3.11716 135.516 3.11716C141.087 3.11716 145.551 4.47165 148.909 7.18061C152.303 9.85346 154 13.628 154 18.5041V26.9561C154 31.9045 152.321 35.679 148.964 38.2796C145.643 40.844 141.161 42.1263 135.516 42.1263C129.871 42.1263 125.37 40.844 122.013 38.2796C118.692 35.679 117.032 31.9045 117.032 26.9561V18.5041C117.032 13.5918 118.71 9.79928 122.068 7.12644ZM132.527 30.4777C133.265 31.2001 134.261 31.5613 135.516 31.5613C136.77 31.5613 137.766 31.2001 138.504 30.4777C139.242 29.7553 139.611 28.6537 139.611 27.1728V18.0707C139.611 16.6259 139.242 15.5423 138.504 14.8199C137.766 14.0614 136.77 13.6821 135.516 13.6821C134.261 13.6821 133.265 14.0614 132.527 14.8199C131.79 15.5423 131.421 16.6259 131.421 18.0707V27.1728C131.421 28.6537 131.79 29.7553 132.527 30.4777Z"
                  fill="white"
                />
              </svg>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
              >
                <path
                  d="M0.324483 14.4838L5.07375 9.73451L0.501474 5.16224C0.285152 4.94592 0.17699 4.68043 0.17699 4.36578C0.17699 4.05113 0.285151 3.78564 0.501473 3.56932L3.71681 0.353982C3.93314 0.13766 4.19862 0.0294988 4.51327 0.0294985C4.82792 0.0294988 5.09341 0.13766 5.30973 0.353983L9.882 4.92625L14.4838 0.324484C14.7001 0.108161 14.9656 2.87747e-07 15.2802 0C15.5949 8.82827e-07 15.8604 0.108163 16.0767 0.324485L19.6755 3.92331C19.8918 4.13963 20 4.40511 20 4.71976C20 5.03442 19.8918 5.2999 19.6755 5.51622L15.0737 10.118L19.587 14.6313C19.8033 14.8476 19.9115 15.1131 19.9115 15.4277C19.9115 15.7424 19.8033 16.0079 19.587 16.2242L16.3717 19.4395C16.1554 19.6559 15.8899 19.764 15.5752 19.764C15.2606 19.764 14.9951 19.6559 14.7788 19.4395L10.2655 14.9263L5.51622 19.6755C5.2999 19.8918 5.03442 20 4.71976 20C4.40511 20 4.13962 19.8918 3.9233 19.6755L0.324482 16.0767C0.10816 15.8604 1.1702e-08 15.5949 0 15.2802C-1.1702e-08 14.9656 0.108161 14.7001 0.324483 14.4838Z"
                  fill="white"
                />
              </svg>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="270"
                height="44"
                viewBox="0 0 270 44"
                fill="none"
              >
                <path
                  d="M1.2163 6.75276L17.4003 3.75405C22.614 2.78802 26.8996 3.13219 30.2571 4.78658C33.6146 6.44096 35.7079 9.41275 36.537 13.7019C37.3661 17.9911 36.513 21.4354 33.9777 24.0348C31.4786 26.6275 27.6042 28.4102 22.3543 29.3829L18.8243 30.037L20.7873 40.1928C20.8627 40.5828 20.783 40.9463 20.5482 41.2836C20.3133 41.6209 19.9968 41.8264 19.5985 41.9002L8.41089 43.9731C8.01262 44.0469 7.64126 43.9688 7.29679 43.7389C6.95233 43.509 6.74241 43.1991 6.66704 42.8092L0.0274702 8.4601C-0.0479015 8.07017 0.0318283 7.70658 0.26666 7.36933C0.501491 7.03208 0.818039 6.82656 1.2163 6.75276ZM15.5104 14.3484L16.6513 20.2505L20.4529 19.5461C21.1046 19.4254 21.6394 19.0876 22.0572 18.5329C22.4681 17.9427 22.588 17.2045 22.4167 16.3183C22.2454 15.4321 21.9023 14.7246 21.3876 14.1957C20.8728 13.6669 20.181 13.483 19.3121 13.644L15.5104 14.3484Z"
                  fill="white"
                />
                <path
                  d="M51.4128 28.8005L66.6395 30.3674C67.0426 30.4088 67.3754 30.5882 67.6377 30.9054C67.9001 31.2226 68.0101 31.5785 67.9677 31.9732L67.0953 40.0999C67.0529 40.4946 66.8698 40.8204 66.5458 41.0772C66.2218 41.3341 65.8582 41.4418 65.4551 41.4003L37.7502 38.5494C37.3471 38.5079 37.0143 38.3285 36.752 38.0113C36.4896 37.6941 36.3796 37.3382 36.422 36.9435L40.1543 2.17626C40.1967 1.78158 40.3799 1.45581 40.7038 1.19894C41.0278 0.942076 41.3914 0.834383 41.7945 0.875865L52.7885 2.00719C53.1916 2.04867 53.5244 2.22802 53.7867 2.54522C54.0491 2.86243 54.1591 3.21837 54.1167 3.61304L51.4128 28.8005Z"
                  fill="white"
                />
                <path
                  d="M76.5429 3.23639L88.3549 1.19721C89.6613 0.971684 90.5833 1.41696 91.1211 2.53303L109.383 34.4388C109.439 34.5391 109.489 34.7136 109.534 34.9623C109.572 35.1755 109.487 35.4284 109.277 35.7209C109.098 35.9717 108.845 36.1253 108.518 36.1817L98.4483 37.9201C97.3597 38.1081 96.5721 37.7861 96.0855 36.9543L94.1456 33.6624L82.4425 35.6828L81.7696 39.4257C81.6029 40.3703 80.9753 40.9366 79.8866 41.1245L69.8165 42.863C69.4899 42.9194 69.1804 42.8629 68.888 42.6936C68.6255 42.4825 68.475 42.2703 68.4366 42.0571C68.3918 41.8084 68.378 41.6277 68.3951 41.5148L74.4101 5.41794C74.5256 4.1891 75.2365 3.46192 76.5429 3.23639ZM83.347 24.8113L89.4979 23.7494L84.61 14.3724L83.347 24.8113Z"
                  fill="white"
                />
                <path
                  d="M124.062 43.6975H113.228C112.823 43.6975 112.473 43.5532 112.178 43.2646C111.883 42.976 111.736 42.6332 111.736 42.2364V31.5756L99.2997 7.49408C99.226 7.34977 99.1892 7.15135 99.1892 6.89881C99.1892 6.64627 99.2997 6.41177 99.5208 6.1953C99.7787 5.94276 100.074 5.81649 100.405 5.81649H110.796C111.902 5.81649 112.676 6.26746 113.118 7.16939L118.645 18.0466L124.172 7.16939C124.615 6.26746 125.388 5.81649 126.494 5.81649H136.885C137.217 5.81649 137.493 5.94276 137.714 6.1953C137.972 6.41177 138.101 6.64627 138.101 6.89881C138.101 7.15135 138.064 7.34977 137.991 7.49408L125.554 31.5756V42.2364C125.554 42.6332 125.407 42.976 125.112 43.2646C124.817 43.5532 124.467 43.6975 124.062 43.6975Z"
                  fill="white"
                />
                <path
                  d="M158.91 0.050674L174.673 2.21973C180.001 2.95279 184.192 4.85931 187.248 7.93929C190.345 10.9886 191.561 14.8354 190.894 19.4798L189.748 27.4645C189.05 32.3233 186.844 35.7721 183.128 37.811C179.412 39.8499 174.817 40.4928 169.343 39.7396L153.525 37.563C153.124 37.5078 152.797 37.3172 152.546 36.9912C152.296 36.6652 152.198 36.3058 152.255 35.9128L157.224 1.29423C157.281 0.901245 157.475 0.581931 157.808 0.33629C158.141 0.0906487 158.508 -0.00455667 158.91 0.050674ZM169.616 12.1801L167.231 28.7927L170.789 29.2822C172.029 29.4529 173.066 29.2312 173.898 28.6171C174.772 27.9723 175.312 26.9354 175.517 25.5064L176.663 17.5216C177.073 14.6635 175.91 13.0462 173.173 12.6696L169.616 12.1801Z"
                  fill="white"
                />
                <path
                  d="M196.008 6.93272C199.094 3.9307 203.404 2.14497 208.938 1.57553C214.471 1.0061 219.05 1.89528 222.674 4.24307C226.33 6.55122 228.419 10.1272 228.939 14.9709L229.84 23.3667C230.368 28.2822 229.103 32.2032 226.045 35.1297C223.02 38.0165 218.705 39.7484 213.098 40.3254C207.491 40.9024 202.883 40.0887 199.275 37.8845C195.699 35.6405 193.648 32.0608 193.12 27.1453L192.219 18.7495C191.695 13.8699 192.958 9.93097 196.008 6.93272ZM208.887 29.0597C209.697 29.7019 210.725 29.9589 211.971 29.8307C213.217 29.7024 214.168 29.2418 214.824 28.4488C215.48 27.6558 215.729 26.5238 215.571 25.0527L214.6 16.0111C214.446 14.5759 213.964 13.5372 213.154 12.895C212.34 12.217 211.31 11.9421 210.064 12.0703C208.818 12.1985 207.869 12.6771 207.217 13.506C206.561 14.299 206.311 15.4131 206.465 16.8482L207.435 25.8899C207.593 27.3609 208.077 28.4176 208.887 29.0597Z"
                  fill="white"
                />
                <path
                  d="M253.845 1.11735L264.619 0.00865133C265.022 -0.0328306 265.385 0.0748625 265.709 0.33173C266.033 0.588598 266.216 0.914369 266.259 1.30904L269.991 36.0763C270.034 36.471 269.924 36.8269 269.661 37.1441C269.399 37.4613 269.066 37.6407 268.663 37.6822L257.889 38.7909C257.486 38.8323 257.122 38.7246 256.798 38.4678C256.474 38.2109 256.291 37.8851 256.249 37.4905L255.001 25.8655L246.096 26.7819L247.344 38.4068C247.386 38.8015 247.276 39.1575 247.014 39.4747C246.751 39.7919 246.418 39.9712 246.015 40.0127L235.241 41.1214C234.838 41.1629 234.476 41.0731 234.156 40.8521C233.832 40.5953 233.647 40.2515 233.601 39.821L229.869 5.05374C229.826 4.65906 229.936 4.30312 230.199 3.98592C230.461 3.66871 230.794 3.48937 231.197 3.44789L241.971 2.33918C242.374 2.2977 242.738 2.4054 243.062 2.66226C243.386 2.91913 243.569 3.2449 243.611 3.63958L244.824 14.9416L253.73 14.0253L252.516 2.7232C252.474 2.32853 252.584 1.97259 252.846 1.65538C253.109 1.33818 253.441 1.15883 253.845 1.11735Z"
                  fill="white"
                />
                <path
                  d="M135.796 22H146.204C146.42 22 146.607 22.1088 146.764 22.3265C146.921 22.5442 147 22.8027 147 23.102V28.898C147 29.1973 146.921 29.4558 146.764 29.6735C146.607 29.8912 146.42 30 146.204 30H135.796C135.58 30 135.393 29.8912 135.236 29.6735C135.079 29.4558 135 29.1973 135 28.898V23.102C135 22.8027 135.079 22.5442 135.236 22.3265C135.393 22.1088 135.58 22 135.796 22Z"
                  fill="white"
                />
              </svg>
            </div>
            <img src={DodoAndPlayDoh} alt="" />
            <img
              src="/bars.png"
              alt=""
              className="absolute bottom-0 left-0  max-sm:w-24"
            />
            <img
              src="/seal.png"
              alt=""
              className="absolute -bottom-10 right-5 max-sm:right-0 max-sm:-bottom-15  max-sm:w-32"
            />
          </div>
        </div>
      </div>
      <ReadCardsBlock />
    </>
  );
}

export default FashionTips;
